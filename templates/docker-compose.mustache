version: '3.5'

services:

{{#services}}
  {{#service_name}}
  {{name}}:
  {{/service_name}}
    {{#image}}
    image: {{name}}
    {{/image}}
    {{#depends_on}}
    depends_on:
      - {{name}}
    {{/depends_on}}
    {{#restart}}
    restart: {{name}}
    {{/restart}}
    {{#command}}
    command: {{name}}
    {{/command}}
    {{#labels}}
    labels:
    {{#label}}
      - "{{name}}"
    {{/label}}
    {{/labels}}
    {{#volumes}}
    volumes:
    {{#vol}}
      - "{{name}}"
    {{/vol}}
    {{/volumes}}
    {{#environment}}
    environment:
    {{#env}}
      - {{name}}
    {{/env}}
    {{/environment}}
    {{#networks}}
    networks:
    {{#net}}
      {{name}}:
      {{#aliases}}
        aliases:
        {{#alias}}
          - {{name}}
        {{/alias}}
      {{/aliases}}
    {{/net}}
    {{/networks}}
{{/services}}

{{#created_volumes}}
volumes:
  htdocs:
    external:
      name: {{prefix}}_htdocs
  config_nginx:
    external:
      name: {{prefix}}_config_nginx
  log_nginx:
    external:
      name: {{prefix}}_log_nginx
{{/created_volumes}}

{{#network}}
networks:
  site-network:
    name: ${VIRTUAL_HOST}
    {{#networks_labels}}
    labels:
    {{#label}}
     - "{{name}}"
    {{/label}}
    {{/networks_labels}}
  global-frontend-network:
    external:
      name: ee-global-frontend-network
{{/network}}
